<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Jakarta WebSocket Team, https://projects.eclipse.org/projects/ee4j.websocket">
<title>Jakarta WebSocket Specification</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Jakarta WebSocket Specification</h1>
<div class="details">
<span id="author" class="author">Jakarta WebSocket Team, https://projects.eclipse.org/projects/ee4j.websocket</span><br>
<span id="email" class="email"><a href="https://dev.eclipse.org/mailman/listinfo/websocket-dev" class="bare">https://dev.eclipse.org/mailman/listinfo/websocket-dev</a></span><br>
<span id="revnumber"> 2.0-RC1,</span>
<span id="revdate">June 12, 2020</span>
<br><span id="revremark">DRAFT</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#eclipse-foundation-specification-license">Eclipse Foundation Specification License</a>
<ul class="sectlevel3">
<li><a href="#disclaimers">Disclaimers</a></li>
</ul>
</li>
<li><a href="#jakarta-websocket-specification-version-2-0">Jakarta WebSocket Specification, Version 2.0</a></li>
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#purpose">1.1. Purpose of this document</a></li>
<li><a href="#goals-of-the-specification">1.2. Goals of the Specification</a></li>
<li><a href="#terminology-used-throughout-the-specification">1.3. Terminology used throughout the Specification</a></li>
<li><a href="#specification-conventions">1.4. Specification Conventions</a></li>
<li><a href="#jcp">1.5. Previous work in the JCP</a></li>
</ul>
</li>
<li><a href="#applications">2. Applications</a>
<ul class="sectlevel2">
<li><a href="#api">2.1. API Overview</a>
<ul class="sectlevel3">
<li><a href="#endpoint-lifecycle">2.1.1. Endpoint Lifecycle</a></li>
<li><a href="#sessions">2.1.2. Sessions</a></li>
<li><a href="#receiving-messages">2.1.3. Receiving Messages</a></li>
<li><a href="#sending-messages">2.1.4. Sending Messages</a></li>
<li><a href="#closing-connections">2.1.5. Closing Connections</a></li>
<li><a href="#clients-and-servers">2.1.6. Clients and Servers</a></li>
<li><a href="#websocketcontainers">2.1.7. WebSocketContainers</a></li>
</ul>
</li>
<li><a href="#endpoints-using-websocket-annotations">2.2. Endpoints using WebSocket Annotations</a>
<ul class="sectlevel3">
<li><a href="#annotated-endpoints">2.2.1. Annotated Endpoints</a></li>
<li><a href="#websocket-lifecycle">2.2.2. WebSocket Lifecycle</a></li>
<li><a href="#handling-messages">2.2.3. Handling Messages</a></li>
<li><a href="#handling-errors">2.2.4. Handling Errors</a></li>
<li><a href="#pings-and-pongs">2.2.5. Pings and Pongs</a></li>
</ul>
</li>
<li><a href="#clientapi">2.3. Jakarta WebSocket Client API</a></li>
</ul>
</li>
<li><a href="#configuration">3. Configuration</a>
<ul class="sectlevel2">
<li><a href="#serverconfig">3.1. Server Configurations</a>
<ul class="sectlevel3">
<li><a href="#uri-mapping">3.1.1. URI Mapping</a></li>
<li><a href="#subprotocol-negotiation">3.1.2. Subprotocol Negotiation</a></li>
<li><a href="#extension-modification">3.1.3. Extension Modification</a></li>
<li><a href="#origin-check">3.1.4. Origin Check</a></li>
<li><a href="#handshake-modification">3.1.5. Handshake Modification</a></li>
<li><a href="#custom-state-or-processing-across-server-endpoint-instances">3.1.6. Custom State or Processing Across Server Endpoint Instances</a></li>
<li><a href="#configuration:creation">3.1.7. Customizing Endpoint Creation</a></li>
</ul>
</li>
<li><a href="#client-configuration">3.2. Client Configuration</a>
<ul class="sectlevel3">
<li><a href="#subprotocols">3.2.1. Subprotocols</a></li>
<li><a href="#extensions">3.2.2. Extensions</a></li>
<li><a href="#client-configuration-modification">3.2.3. Client Configuration Modification</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#annotations">4. Annotations</a>
<ul class="sectlevel2">
<li><a href="#serverendpoint">4.1. @ServerEndpoint</a>
<ul class="sectlevel3">
<li><a href="#value">4.1.1. value</a></li>
<li><a href="#encoders">4.1.2. encoders</a></li>
<li><a href="#decoders">4.1.3. decoders</a></li>
<li><a href="#subprotocols-1">4.1.4. subprotocols</a></li>
<li><a href="#configurator">4.1.5. configurator</a></li>
</ul>
</li>
<li><a href="#clientendpoint">4.2. @ClientEndpoint</a>
<ul class="sectlevel3">
<li><a href="#encoders-1">4.2.1. encoders</a></li>
<li><a href="#decoders-1">4.2.2. decoders</a></li>
<li><a href="#configurator-1">4.2.3. configurator</a></li>
<li><a href="#subprotocols-2">4.2.4. subprotocols</a></li>
</ul>
</li>
<li><a href="#pathparam">4.3. @PathParam</a></li>
<li><a href="#onopen">4.4. @OnOpen</a></li>
<li><a href="#onclose">4.5. @OnClose</a></li>
<li><a href="#onerror">4.6. @OnError</a></li>
<li><a href="#onmessage">4.7. @OnMessage</a>
<ul class="sectlevel3">
<li><a href="#maxmessagesize">4.7.1. maxMessageSize</a></li>
</ul>
</li>
<li><a href="#websockets-and-inheritance">4.8. WebSockets and Inheritance</a></li>
</ul>
</li>
<li><a href="#exception-handling-and-threading">5. Exception handling and Threading</a>
<ul class="sectlevel2">
<li><a href="#threading-considerations">5.1. Threading Considerations</a></li>
<li><a href="#exception:error">5.2. Error Handling</a>
<ul class="sectlevel3">
<li><a href="#deployment-errors">5.2.1. Deployment Errors</a></li>
<li><a href="#errors-originating-in-websocket-application-code">5.2.2. Errors Originating in WebSocket Application Code</a></li>
<li><a href="#errors-originating-in-the-container-andor-underlying-connection">5.2.3. Errors Originating in the Container and/or Underlying Connection</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#packaging-and-deployment">6. Packaging and Deployment</a>
<ul class="sectlevel2">
<li><a href="#client-deployment-on-jdk">6.1. Client Deployment on JRE</a></li>
<li><a href="#application-deployment-on-web-containers">6.2. Application Deployment on Web Containers</a></li>
<li><a href="#application-deployment-in-standalone-websocket-server-containers">6.3. Application Deployment in Standalone WebSocket Server Containers</a></li>
<li><a href="#programmatic-server-deployment">6.4. Programmatic Server Deployment</a></li>
<li><a href="#websocket-server-paths">6.5. WebSocket Server Paths</a></li>
<li><a href="#platform-versions">6.6. Platform Versions</a></li>
</ul>
</li>
<li><a href="#jakartaee">7. Jakarta EE Environment</a>
<ul class="sectlevel2">
<li><a href="#jakarta-ee-environment">7.1. Jakarta EE Environment</a>
<ul class="sectlevel3">
<li><a href="#websocket-endpoints-and-dependency-injection">7.1.1. WebSocket Endpoints and Dependency Injection</a></li>
</ul>
</li>
<li><a href="#jakartaee:httpsession">7.2. Relationship with Http Session and Authenticated State</a></li>
</ul>
</li>
<li><a href="#security">8. Server Security</a>
<ul class="sectlevel2">
<li><a href="#authentication-of-websockets">8.1. Authentication of Websockets</a></li>
<li><a href="#authorization-of-websockets">8.2. Authorization of Websockets</a></li>
<li><a href="#transport-guarantee">8.3. Transport Guarantee</a></li>
<li><a href="#example">8.4. Example</a></li>
</ul>
</li>
<li><a href="#changes">Appendix A: Changes</a>
<ul class="sectlevel2">
<li><a href="#changes-since-jsr-356">A.1. Changes Between 2.0 and JSR-356</a></li>
</ul>
</li>
<li><a href="#bibliography">Bibliography</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>Specification: Jakarta WebSocket Specification

Version: 2.0-RC1

Status: DRAFT

Release: June 12, 2020</pre>
</div>
</div>
<div class="paragraph">
<p>Copyright (c) 2018, 2020 Eclipse Foundation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="eclipse-foundation-specification-license"><a class="anchor" href="#eclipse-foundation-specification-license"></a>Eclipse Foundation Specification License</h3>
<div class="paragraph">
<p>By using and/or copying this document, or the Eclipse Foundation
document from which this statement is linked, you (the licensee) agree
that you have read, understood, and will comply with the following
terms and conditions:</p>
</div>
<div class="paragraph">
<p>Permission to copy, and distribute the contents of this document, or
the Eclipse Foundation document from which this statement is linked, in
any medium for any purpose and without fee or royalty is hereby
granted, provided that you include the following on ALL copies of the
document, or portions thereof, that you use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>link or URL to the original Eclipse Foundation document.</p>
</li>
<li>
<p>All existing copyright notices, or if one does not exist, a notice
(hypertext is preferred, but a textual representation is permitted)
of the form: "Copyright © [$date-of-document] Eclipse Foundation, Inc.
&lt;&lt;url to this license&gt;&gt;"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inclusion of the full text of this NOTICE must be provided. We
request that authorship attribution be provided in any software,
documents, or other items or products that you create pursuant to the
implementation of the contents of this document, or any portion
thereof.</p>
</div>
<div class="paragraph">
<p>No right to create modifications or derivatives of Eclipse Foundation
documents is granted pursuant to this license, except anyone may
prepare and distribute derivative works and portions of this document
in software that implements the specification, in supporting materials
accompanying such software, and in documentation of such software,
PROVIDED that all such works include the notice below. HOWEVER, the
publication of derivative works of this document for use as a technical
specification is expressly prohibited.</p>
</div>
<div class="paragraph">
<p>The notice is:</p>
</div>
<div class="paragraph">
<p>"Copyright © 2018, 2020 Eclipse Foundation. This software or document
includes material copied from or derived from
Jakarta ® WebSocket
<a href="https://jakarta.ee/specifications/websocket/2.0/">https://jakarta.ee/specifications/websocket/2.0/</a>"</p>
</div>
<div class="sect3">
<h4 id="disclaimers"><a class="anchor" href="#disclaimers"></a>Disclaimers</h4>
<div class="paragraph">
<p>THIS DOCUMENT IS PROVIDED &quot;AS IS,&quot; AND THE COPYRIGHT
HOLDERS AND THE ECLIPSE FOUNDATION MAKE NO REPRESENTATIONS OR
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,
NON-INFRINGEMENT, OR TITLE; THAT THE CONTENTS OF THE DOCUMENT ARE
SUITABLE FOR ANY PURPOSE; NOR THAT THE IMPLEMENTATION OF SUCH CONTENTS
WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, TRADEMARKS OR
OTHER RIGHTS.</p>
</div>
<div class="paragraph">
<p>THE COPYRIGHT HOLDERS AND THE ECLIPSE FOUNDATION WILL NOT BE LIABLE
FOR ANY DIRECT, INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT
OF ANY USE OF THE DOCUMENT OR THE PERFORMANCE OR IMPLEMENTATION OF THE
CONTENTS THEREOF.</p>
</div>
<div class="paragraph">
<p>The name and trademarks of the copyright holders or the Eclipse
Foundation may NOT be used in advertising or publicity pertaining to
this document or its contents without specific, written prior
permission. Title to copyright in this document will at all times
remain with copyright holders.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakarta-websocket-specification-version-2-0"><a class="anchor" href="#jakarta-websocket-specification-version-2-0"></a>Jakarta WebSocket Specification, Version 2.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright (c) 2011, 2020 Oracle and/or its affiliates and others.
All rights reserved.</p>
</div>
<div class="paragraph">
<p>Eclipse is a registered trademark of the Eclipse Foundation. Jakarta
is a trademark of the Eclipse Foundation. Oracle and Java are
registered trademarks of Oracle and/or its affiliates. Other names
may be trademarks of their respective owners.</p>
</div>
<div class="paragraph">
<p>The Jakarta WebSocket Team - June 12, 2020</p>
</div>
<div class="paragraph">
<p>Comments to: <a href="mailto:websocket-dev@eclipse.org">websocket-dev@eclipse.org</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This specification defines a set of Java APIs for the development of
WebSocket applications. Readers are assumed to be familiar with the
WebSocket protocol. The WebSocket protocol, developed as part of the
collection of technologies that make up HTML5, promises to bring a new
level of ease of development and network efficiency to modern,
interactive web applications. For more information on the WebSocket
protocol see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The WebSocket Protocol specification (Fette and Melnikov 2011)</p>
</li>
<li>
<p>The WebSocket API for JavaScript (Hickson 2012)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="purpose"><a class="anchor" href="#purpose"></a>1.1. Purpose of this document</h3>
<div class="paragraph">
<p>This document in combination with the API documentation for the Jakarta
WebSocket API is the specification of the Jakarta WebSocket API. The
specification defines the requirements that an implementation must meet
in order to be an implementation of the Jakarta WebSocket API. This
specification has been developed under the Eclipse Foundation Specification
Process. Together with the Test Compatibility Kit (TCK) which tests that
a given implementation meets the requirements of the specification, and
Compatible Implementations (CIs) that implement this specification and
which pass the TCK, this specification defines the Jakarta standard for
WebSocket application development.</p>
</div>
<div class="paragraph">
<p>While there is much useful information in this document for developers
using the Jakarta WebSocket API, its purpose is not to be a developers
guide. Similarly, while there is much useful information in this
document for developers who are creating an implementation of the Jakarta
WebSocket API, its purpose is not to be a 'How To' guide as to how to
implement all the required features.</p>
</div>
</div>
<div class="sect2">
<h3 id="goals-of-the-specification"><a class="anchor" href="#goals-of-the-specification"></a>1.2. Goals of the Specification</h3>
<div class="paragraph">
<p>The goal of this specification is to define the requirements on
containers that wish to support APIs for WebSocket programming on the
Jakarta and Java Platforms. While the document may be a useful reference for
developers who use the APIs defined by this specification, this document
is not a developer guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="terminology-used-throughout-the-specification"><a class="anchor" href="#terminology-used-throughout-the-specification"></a>1.3. Terminology used throughout the Specification</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">endpoint</dt>
<dd>
<p>A WebSocket endpoint is a Java component that represents one side of a
sequence of WebSocket interactions between two connected peers.</p>
</dd>
<dt class="hdlist1">connection</dt>
<dd>
<p>A WebSocket connection is the networking connection between the two
endpoints which are interacting using the WebSocket protocol.</p>
</dd>
<dt class="hdlist1">peer</dt>
<dd>
<p>Used in the context of a WebSocket endpoint, the WebSocket peer is
used to represent another participant of the WebSocket
interactions with the endpoint.</p>
</dd>
<dt class="hdlist1">session</dt>
<dd>
<p>The term WebSocket session is used to represent a sequence of
WebSocket interactions between an endpoint and a single peer.</p>
</dd>
<dt class="hdlist1">client endpoints and server endpoints</dt>
<dd>
<p>A client endpoint is one that initiates a connection to a peer but
does not accept new ones. A server endpoint is one that accepts
WebSocket connections from peers but does not initiate connections to
peers.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="specification-conventions"><a class="anchor" href="#specification-conventions"></a>1.4. Specification Conventions</h3>
<div class="paragraph">
<p>The keywords 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL NOT',
'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY', and 'OPTIONAL' in this
document are to be interpreted as described in RFC 2119 (Bradner 1997).</p>
</div>
<div class="paragraph">
<p>Additionally, requirements of the specification that can be tested using
the conformance test suite are marked with the figure WSC (WebSocket
Compatibility) followed by a number which is used to identify the
requirement, for example 'WSC-12'.</p>
</div>
<div class="paragraph">
<p>Java code and sample data fragments are formatted as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example.hello</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Hello</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span> args<span class="type">[]</span>) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>URIs of the general form 'http://example.org/&#8230;&#8203;' and
'http://example.com/&#8230;&#8203;' represent application or context-dependent
URIs.</p>
</div>
<div class="paragraph">
<p>All parts of this specification are normative, with the exception of
examples, notes and sections explicitly marked as 'Non-Normative'.
Non-normative notes are formatted as shown below.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> <em>This is a note.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="jcp"><a class="anchor" href="#jcp"></a>1.5. Previous work in the JCP</h3>
<div class="paragraph">
<p>Prior to version 2.0, this specification was developed in the Java
Community Process as part of JSR 356.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="applications"><a class="anchor" href="#applications"></a>2. Applications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jakarta WebSocket applications consist of WebSocket endpoints. A WebSocket
endpoint is a Java object that represents one end of a WebSocket
connection between two peers.</p>
</div>
<div class="paragraph">
<p>There are two main means by which an endpoint can be created. The first
means is to implement certain of the API classes from the Jakarta WebSocket
API with the required behavior to handle the endpoint lifecycle, consume
and send messages, publish itself, or connect to a peer. Often, this
specification will refer to this kind of endpoint as a <em>programmatic
endpoint</em>. The second means is to decorate a Plain Old Java Object
(POJO) with certain of the annotations from the Jakarta WebSocket API. The
implementation then takes these annotated classes and creates the
appropriate objects at runtime to deploy the POJO as a WebSocket
endpoint. Often, this specification will refer to this kind of endpoint
as an <em>annotated endpoint</em>. The specification will refer to an
endpoint when it is talking about either kind of endpoint: programmatic
or annotated.</p>
</div>
<div class="paragraph">
<p>The endpoint participates in the opening handshake that establishes the
WebSocket connection. The endpoint will typically send and receive a
variety of WebSocket messages. The endpoint’s lifecycle comes to an end
when the WebSocket connection is closed.</p>
</div>
<div class="sect2">
<h3 id="api"><a class="anchor" href="#api"></a>2.1. API Overview</h3>
<div class="paragraph">
<p>This section gives a brief overview of the Jakarta WebSocket API in order
to set the stage for the detailed requirements that follow.</p>
</div>
<div class="sect3">
<h4 id="endpoint-lifecycle"><a class="anchor" href="#endpoint-lifecycle"></a>2.1.1. Endpoint Lifecycle</h4>
<div class="paragraph">
<p>A logical WebSocket endpoint is represented in the Jakarta WebSocket API by
instances of the <strong>Endpoint</strong> class. Developers may subclass the
<strong>Endpoint</strong> class with a public, concrete class in order to intercept
lifecycle events of the endpoint: those of a peer connecting, an open
connection ending and an error being raised during the lifetime of the
endpoint.</p>
</div>
<div class="paragraph">
<p>Unless otherwise overridden by a developer provided configurator (see
<a href="#configuration:creation">Section 3.1.7</a>), the WebSocket implementation must use one
instance per application per VM of the <strong>Endpoint</strong> class to represent the
logical endpoint per connected peer [WSC 2.1.1-1]. Each instance of the
<strong>Endpoint</strong> class in this typical case only handles connections to the
endpoint from one and only one peer.</p>
</div>
</div>
<div class="sect3">
<h4 id="sessions"><a class="anchor" href="#sessions"></a>2.1.2. Sessions</h4>
<div class="paragraph">
<p>The Jakarta WebSocket API models the sequence of interactions between an
endpoint and each of its peers using an instance of the <strong>Session</strong> class.
The interactions between a peer and an endpoint begin with an open
notification, followed by some number, possibly zero, of WebSocket
messages between the endpoint and peer, followed by a close notification
or possibly a fatal error which terminates the connection. For each peer
that is interacting with an endpoint, there is one unique <strong>Session</strong>
instance that represents that interaction [WSC 2.1.2-1]. This <strong>Session</strong>
instance corresponding to the connection with that peer is passed to the
endpoint instance representing the logical endpoint at the key events in
its lifecycle.</p>
</div>
<div class="paragraph">
<p>Developers may use the user property map accessible through the
<strong>getUserProperties()</strong> call on the <strong>Session</strong> object to associate
application specific information with a particular session. The
WebSocket implementation must preserve this session data for later
access until the completion of the <strong>onClose()</strong> method on the endpoint
instance [WSC 2.1.2-2]. After that time, the WebSocket implementation
is permitted to discard the developer data. A WebSocket implementation
that chooses to pool <strong>Session</strong> instances may at that point re-use the
same <strong>Session</strong> instance to represent a new connection provided it issues
a new unique <strong>Session</strong> id [WSC 2.1.2-3].</p>
</div>
<div class="paragraph">
<p>WebSocket implementations that are part of a distributed container may
need to migrate WebSocket sessions from one node to another in the case
of a failover. Implementations are required to preserve developer data
objects inserted into the WebSocket session if the data is marked
<strong>java.io.Serializable</strong> [WSC 2.1.2-4].</p>
</div>
</div>
<div class="sect3">
<h4 id="receiving-messages"><a class="anchor" href="#receiving-messages"></a>2.1.3. Receiving Messages</h4>
<div class="paragraph">
<p>The Jakarta WebSocket API presents a variety of means for an endpoint to
receive messages from its peers. Developers implement the subtype of the
<strong>MessageHandler</strong> interface with the message delivery style that
best suits their needs, and register the interest in messages from a
particular peer by registering the handler on the Session instance
corresponding to the peer.</p>
</div>
<div class="paragraph">
<p>The API limits the registration of <strong>MessageHandlers</strong> per <strong>Session</strong> to be
one <strong>MessageHandler</strong> per native WebSocket message type [WSC 2.1.3-1]. In
other words, the developer can only register at most one
<strong>MessageHandler</strong> for incoming text messages, one <strong>MessageHandler</strong> for
incoming binary messages, and one <strong>MessageHandler</strong> for incoming pong
messages. The WebSocket implementation must generate an error if this
restriction is violated [WSC 2.1.3-2].</p>
</div>
<div class="paragraph">
<p>Future versions of the specification may lift this restriction.</p>
</div>
<div class="paragraph">
<p>Method <strong>Session.addMessageHandler(MessageHandler)</strong> is not safe for use
in all circumstances, especially when using Lambda Expressions. The API
forces implementations to get the <strong>MessageHandler</strong>’s type parameter in
runtime, which is not always possible. The only case where you can
safely use this method is when you are directly implementing
<strong>MessageHandler.Whole</strong> or <strong>MessageHandler.Partial</strong> as an anonymous
class. This approach guarantees that generic type information will be
present in the generated class file and the runtime will be able to get
it. For any other case (Lambda Expressions included), one of following
methods have to be used:
<strong>Session.addMessageHandler(Class&lt;T&gt;, MessageHandler.Partial&lt;T&gt;)</strong> or
<strong>Session.addMessageHandler(Class&lt;T&gt;, MessageHandler.Whole&lt;T&gt;)</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="sending-messages"><a class="anchor" href="#sending-messages"></a>2.1.4. Sending Messages</h4>
<div class="paragraph">
<p>The Jakarta WebSocket API models each peer of a session with an endpoint as
an instance of the <strong>RemoteEndpoint</strong> interface. This interface and its
two subtypes (<strong>RemoteEndpoint.Whole</strong> and <strong>RemoteEndpoint.Partial</strong>)
contain a variety of methods for sending WebSocket messages from the
endpoint to its peer.</p>
</div>
<div class="paragraph">
<p>Here is an example of a server endpoint that waits for incoming text
messages, and responds immediately when it gets one to the client that
sent it. The example endpoint is shown, first using only the API
classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloServer</span> <span class="directive">extends</span> Endpoint {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onOpen(Session session, EndpointConfig ec) {
        <span class="directive">final</span> RemoteEndpoint.Basic remote = session.getBasicRemote();
        session.addMessageHandler(<span class="predefined-type">String</span>.class,
            <span class="keyword">new</span> MessageHandler.Whole&lt;<span class="predefined-type">String</span>&gt;() {
                <span class="directive">public</span> <span class="type">void</span> onMessage(<span class="predefined-type">String</span> text) {
                    <span class="keyword">try</span> {
                        remote.sendText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Got your message (</span><span class="delimiter">&quot;</span></span> + text + <span class="string"><span class="delimiter">&quot;</span><span class="content">). Thanks !</span><span class="delimiter">&quot;</span></span>);
                    } <span class="keyword">catch</span> (<span class="exception">IOException</span> ioe) {
                        ioe.printStackTrace();
                    }
                }
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and second using the annotations in the API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyHelloServer</span> {
    <span class="annotation">@OnMessage</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> handleMessage(<span class="predefined-type">String</span> message) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Got your message (</span><span class="delimiter">&quot;</span></span> + message + <span class="string"><span class="delimiter">&quot;</span><span class="content">). Thanks !</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> <em>The examples are almost equivalent save for the annotated endpoint
carries its own path mapping.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="closing-connections"><a class="anchor" href="#closing-connections"></a>2.1.5. Closing Connections</h4>
<div class="paragraph">
<p>If an open connection to a WebSocket endpoint is to be closed for any
reason, whether as a result of receiving a WebSocket close event from
the peer, or because the underlying implementation has reason to close
the connection, the WebSocket implementation must invoke the <strong>onClose()</strong>
method of the WebSocket endpoint [WSC 2.1.5-1].</p>
</div>
<div class="paragraph">
<p>If the close was initiated by the remote peer, the implementation must
use the close code and reason sent in the WebSocket protocol close
frame. If the close was initiated by the local container, for example if
the local container determines the session has timed out, the local
implementation must use the WebSocket protocol close code
<code>1006</code> (a code especially disallowed in close frames on the
wire), with a suitable close reason. That way the endpoint can determine
whether the close was initiated remotely or locally. If the session is
closed locally, the implementation must attempt to send the WebSocket
close frame prior to calling the <strong>onClose()</strong> method of the WebSocket
endpoint.</p>
</div>
</div>
<div class="sect3">
<h4 id="clients-and-servers"><a class="anchor" href="#clients-and-servers"></a>2.1.6. Clients and Servers</h4>
<div class="paragraph">
<p>The WebSocket protocol is a two-way protocol. Once established, the
WebSocket protocol is symmetrical between the two parties in the
conversation. The difference between a WebSocket <em>client</em> and a
WebSocket <em>server</em> lies only in the means by which the two parties are
connected. In this specification, we will say that a WebSocket <em>client</em> is
a WebSocket endpoint that initiates a connection to a peer. We will say
that a WebSocket <em>server</em> is a WebSocket endpoint that is published and
awaits connections from peers. In most deployments, a WebSocket client
will connect to only one WebSocket server, and a WebSocket server will
accept connections from several clients.</p>
</div>
<div class="paragraph">
<p>Accordingly, the WebSocket API only distinguishes between endpoints that
are WebSocket clients from endpoints that are WebSocket servers in the
configuration and setup phase.</p>
</div>
</div>
<div class="sect3">
<h4 id="websocketcontainers"><a class="anchor" href="#websocketcontainers"></a>2.1.7. WebSocketContainers</h4>
<div class="paragraph">
<p>The WebSocket implementation is represented to applications by instances
of the <strong>WebSocketContainer</strong> class. Each <strong>WebSocketContainer</strong> instance
carries a number of configuration properties that apply to endpoints
deployed within it. In server deployments of WebSocket implementations,
there is one unique <strong>WebSocketContainer</strong> instance per application per
Java VM [WSC 2.1.7-1]. In client deployments of WebSocket
implementations, applications obtain instances of the
<strong>WebSocketContainer</strong> from the <strong>ContainerProvider</strong> class.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="endpoints-using-websocket-annotations"><a class="anchor" href="#endpoints-using-websocket-annotations"></a>2.2. Endpoints using WebSocket Annotations</h3>
<div class="paragraph">
<p>Java annotations have become widely used as a means to add deployment
characteristics to Java objects, particularly in the Jakarta EE platform.
The Jakarta WebSocket specification defines a small number of WebSocket
annotations that allow developers to take Java classes and turn them
into WebSocket endpoints. This section gives a short overview to set the
stage for more detailed requirements later in this specification.</p>
</div>
<div class="sect3">
<h4 id="annotated-endpoints"><a class="anchor" href="#annotated-endpoints"></a>2.2.1. Annotated Endpoints</h4>
<div class="paragraph">
<p>The class level <strong>@ServerEndpoint</strong> annotation indicates that a Java class
is to become a WebSocket endpoint at runtime. Developers may use the
value attribute to specify a URI mapping for the endpoint. The
<strong>encoders</strong> and <strong>decoders</strong> attributes allow the developer to specify
classes that encode application objects into WebSocket messages, and
decode WebSocket messages into application objects.</p>
</div>
</div>
<div class="sect3">
<h4 id="websocket-lifecycle"><a class="anchor" href="#websocket-lifecycle"></a>2.2.2. WebSocket Lifecycle</h4>
<div class="paragraph">
<p>The method level <strong>@OnOpen</strong> and <strong>@OnClose</strong> annotations allow the
developers to decorate methods on their <strong>@ServerEndpoint</strong> annotated Java
class to specify that they must be called by the implementation when the
resulting endpoint receives a new connection from a peer or when a
connection from a peer is closed, respectively [WSC 2.2.2-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="handling-messages"><a class="anchor" href="#handling-messages"></a>2.2.3. Handling Messages</h4>
<div class="paragraph">
<p>In order that the annotated endpoint can process incoming messages, the
method level <strong>@OnMessage</strong> annotation allows the developer to indicate
which methods the implementation must call when a message is received [WSC 2.2.3-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="handling-errors"><a class="anchor" href="#handling-errors"></a>2.2.4. Handling Errors</h4>
<div class="paragraph">
<p>In order that an annotated endpoint can handle errors that occur as a
arising from external events, for example on decoding an incoming
message, an annotated endpoint can use the <strong>@OnError</strong> annotation to mark
one of its methods that must be called by the implementation with information
about the error whenever such an error occurs [WSC 2.2.4-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="pings-and-pongs"><a class="anchor" href="#pings-and-pongs"></a>2.2.5. Pings and Pongs</h4>
<div class="paragraph">
<p>The ping/pong mechanism in the WebSocket protocol serves as a check that
the connection is still active. Following the requirements of the
protocol, if a WebSocket implementation receives a ping message from a
peer, it must respond as soon as possible to that peer with a pong
message containing the same application data [WSC 2.2.5-1]. Developers
who wish to send a unidirectional pong message may do so using the
<strong>RemoteEndpoint</strong> API. Developers wishing to listen for returning pong
messages may either define a <strong>MessageHandler</strong> for them, or annotate a
method using the <strong>@OnMessage</strong> annotation where the method stipulates a
<strong>PongMessage</strong> as its message entity parameter. In either case, if the
implementation receives a pong message addressed to this endpoint, it
must call that MessageHandler or that annotated method [WSC 2.2.5-2].</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clientapi"><a class="anchor" href="#clientapi"></a>2.3. Jakarta WebSocket Client API</h3>
<div class="paragraph">
<p>This specification defines two configurations of the Jakarta WebSocket API.
The Jakarta WebSocket API is used to mean the full functionality defined in
this specification. This API is intended to be implemented either as a
standalone WebSocket implementation, as part of a Jakarta Servlet
container, or as part of a full Jakarta EE platform implementation. The
APIs that must be implemented to conform to the Jakarta WebSocket API are
all the Java APIs in the packages <strong>jakarta.websocket.</strong>* and
<strong>jakarta.websocket.server.</strong>*. Some of the non-API features of the Jakarta
WebSocket API are optional when the API is not implemented as part of
the full Jakarta EE platform, for example, the requirement that WebSocket
endpoints be non-contextual managed beans (see Chapter 7). Such Jakarta EE
only features are clearly marked where they are described.</p>
</div>
<div class="paragraph">
<p>The Jakarta WebSocket API also contains a subset of its functionality
intended for desktop, tablet or smartphone devices. This subset does not
contain the ability to deploy server endpoints. This subset known as the
Jakarta WebSocket Client API. The APIs that must be implemented to conform
to the Jakarta WebSocket Client API are all the Java APIs in the package
<strong>jakarta.websocket.</strong>*.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>3. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WebSocket applications are configured with a number of key parameters:
the path mapping that identifies a WebSocket endpoint in the URI-space
of the container, the subprotocols that the endpoint supports, and the
extensions that the application requires. Additionally, during the
opening handshake, the application may choose to perform other
configuration tasks, such as checking the hostname of the requesting
client, or processing cookies. This section details the requirements on
the container to support these configuration tasks.</p>
</div>
<div class="paragraph">
<p>Both client and server endpoint configurations include a list of
application provided encoder and decoder classes that the implementation
must use to translate between WebSocket messages and application defined
message objects [WSC-3-1].</p>
</div>
<div class="sect2">
<h3 id="serverconfig"><a class="anchor" href="#serverconfig"></a>3.1. Server Configurations</h3>
<div class="paragraph">
<p>In order to deploy a programmatic endpoint into the URI space available
for client connections, the container requires a <strong>ServerEndpointConfig</strong>
instance. This object holds configuration data and the default
implementation provided algorithms needed by the implementation to
configure the endpoint. The WebSocket API allow certain of these
configuration operations to be overriden by developers by providing a
custom <strong>ServerEndpointConfig.Configurator</strong> implementation with the
<strong>ServerEndpointConfig</strong> [WSC-3.1-1].</p>
</div>
<div class="paragraph">
<p>These operations are laid out below.</p>
</div>
<div class="sect3">
<h4 id="uri-mapping"><a class="anchor" href="#uri-mapping"></a>3.1.1. URI Mapping</h4>
<div class="paragraph">
<p>This section describes the the URI mapping policy for server endpoints.</p>
</div>
<div class="paragraph">
<p>All server endpoint paths must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>be a URI-template (level-1) or a partial URI</p>
</li>
<li>
<p>start with a leading '/'</p>
</li>
<li>
<p>not contain the sequences <code>/../</code>, <code>/./</code> or <code>//</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, URI-template server endpoint paths must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only replace whole URI segments with variables</p>
</li>
<li>
<p>Not use the same variable more than once in a path</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a definition of URI segments, see RFC 3986 (Berners-Lee et al. 2005).
For a definition of URI-templates, see RFC 6570 (Gregorio et al. 2012).</p>
</div>
<div class="paragraph">
<p>The WebSocket implementation must compare the normalized - see section 6
of RFC 3986 (Berners-Lee et al. 2005) - incoming URI to the
collection of all endpoint paths and determine the best match. The
incoming URI in an opening handshake request matches an endpoint path if
either it is an exact match in the case where the endpoint path is a
relative URI, and if it is a valid expansion of the endpoint path in the
case where the endpoint path is a URI template [WSC-3.1.1-1].</p>
</div>
<div class="paragraph">
<p>An application that contains multiple endpoint paths that are the same
relative URI is not a valid application. An application that contains
multiple endpoint paths that are equivalent URI-templates is not a valid
application [WSC-3.1.1-2].</p>
</div>
<div class="paragraph">
<p>However, it is possible for an incoming URI in an opening handshake
request theoretically to match more than one endpoint path. For example,
consider the following case:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>incoming URI: "/a/b"</p>
</li>
<li>
<p>endpoint A is mapped to "/a/b"</p>
</li>
<li>
<p>endpoint B is mapped to /a/{customer-name}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The WebSocket implementation will attempt to match an incoming URI to an
endpoint path (URI or level 1 URI-template) in the application in a
manner equivalent to the following: [WSC-3.1.1-3]</p>
</div>
<div class="paragraph">
<p>Since the endpoint paths are either relative URIs or URI templates level
1, the paths do not match if they do not have the same number of
segments, using '/' as the separator. So, the container will traverse
the segments of the endpoint paths with the same number of segments as
the incoming URI from left to right, comparing each segment with the
corresponding segment of the incoming URI. At each segment, the
implementation will retain those endpoint paths that match exactly, or
if there are none, those that are a variable segment, before moving to
check the next segment. If there is an endpoint path at the end of this
process there is a match.</p>
</div>
<div class="paragraph">
<p>Because of the requirement disallowing multiple endpoint paths and
equivalent URI-templates, and the preference for exact matches at each
segment, there can only be at most one path, and it is the best match.</p>
</div>
<div class="paragraph">
<p>Examples</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>suppose an endpoint has path /a/b/, the only incoming URI that
matches this is /a/b/</p>
</li>
<li>
<p>suppose an endpoint is mapped to /a/{var}</p>
<div class="ulist">
<ul>
<li>
<p>incoming URIs that do match:</p>
<div class="ulist">
<ul>
<li>
<p>/a/b (with var=b)</p>
</li>
<li>
<p>/a/apple (with var=apple)</p>
</li>
</ul>
</div>
</li>
<li>
<p>URIs that do NOT match (because empty string and strings
with reserved characters "/" are not valid URI-template level 1
expansions):</p>
<div class="ulist">
<ul>
<li>
<p>/a</p>
</li>
<li>
<p>/a/b/</p>
</li>
<li>
<p>/a/b/c</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>suppose we have three endpoints and their paths:</p>
<div class="ulist">
<ul>
<li>
<p>endpoint A: /a/{var}/c</p>
</li>
<li>
<p>endpoint B: /a/b/c</p>
</li>
<li>
<p>endpoint C: /a/{var1}/{var2}</p>
</li>
<li>
<p>incoming URI: a/b/c matches B, not A or C, because an exact match is
preferred.</p>
</li>
<li>
<p>incoming URI: a/d/c matches A with variable var=d, because an exact
matching segment is preferred over a variable segment</p>
</li>
<li>
<p>incoming URI: a/x/y/ matches C, with var1=x, var2=y</p>
</li>
</ul>
</div>
</li>
<li>
<p>suppose we have two endpoints</p>
<div class="ulist">
<ul>
<li>
<p>endpoint A: /{var1}/d</p>
</li>
<li>
<p>endpoint B: /b/{var2}</p>
</li>
<li>
<p>incoming URI: /b/d matches B with var2=d, not A with var1=b because the
matching process works from left to right.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The implementation must not establish the connection unless there is a
match [WSC-3.1.1-4].</p>
</div>
</div>
<div class="sect3">
<h4 id="subprotocol-negotiation"><a class="anchor" href="#subprotocol-negotiation"></a>3.1.2. Subprotocol Negotiation</h4>
<div class="paragraph">
<p>The default server configuration must be provided a list of supported
subprotocols in order of preference at creation time. During subprotocol
negotiation, this configuration examines the client-supplied subprotocol
list and selects the first subprotocol in the list it supports that is
contained within the list provided by the client, or none if there is no
match [WSC-3.1.2-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="extension-modification"><a class="anchor" href="#extension-modification"></a>3.1.3. Extension Modification</h4>
<div class="paragraph">
<p>In the opening handshake, the client supplies a list of extensions that
it would like to use. The default server configuration selects from
those extensions the ones it supports, and places them in the same order
as requested by the client [WSC-3.1.3-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="origin-check"><a class="anchor" href="#origin-check"></a>3.1.4. Origin Check</h4>
<div class="paragraph">
<p>The default server configuration makes a check of the hostname provided
in the Origin header, failing the handshake if the hostname cannot be
verified [WSC-3.1.4-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="handshake-modification"><a class="anchor" href="#handshake-modification"></a>3.1.5. Handshake Modification</h4>
<div class="paragraph">
<p>The default server configuration makes no modification of the opening
handshake process other than that described above [WSC-3.1.5-1].</p>
</div>
<div class="paragraph">
<p>Developers may wish to customize the configuration and handshake
negotiation policies laid out above. In order to do so, they may provide
their own implementations of <strong>ServerEndpointConfig.Configurator</strong>.</p>
</div>
<div class="paragraph">
<p>For example, developers may wish to intervene more in the handshake
process. They may wish to use Http cookies to track clients, or insert
application specific headers in the handshake response. In order to do
this, they may implement the <strong>modifyHandshake()</strong> method on the
<strong>ServerEndpointConfig.Configurator</strong>, wherein they have full access to
the <strong>HandshakeRequest</strong> and <strong>HandshakeResponse</strong> of the handshake.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-state-or-processing-across-server-endpoint-instances"><a class="anchor" href="#custom-state-or-processing-across-server-endpoint-instances"></a>3.1.6. Custom State or Processing Across Server Endpoint Instances</h4>
<div class="paragraph">
<p>The developer may also implement <strong>ServerEndpointConfig.Configurator</strong> in
order to hold custom application state or methods for other kinds of
application specific processing that is accessible from all <strong>Endpoint</strong>
instances of the same logical endpoint via the <strong>EndpointConfig</strong> object.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration:creation"><a class="anchor" href="#configuration:creation"></a>3.1.7. Customizing Endpoint Creation</h4>
<div class="paragraph">
<p>The developer may control the creation of endpoint instances by
supplying a <strong>ServerEndpointConfig.Configurator</strong> object that overrides
the <strong>getEndpointInstance()</strong> call. The implementation must call this
method each time a new client connects to the logical endpoint
[WSC-3.1.7-1]. The platform default implementation of this method is to
return a new instance of the endpoint class each time it is called [WSC-3.1.7-2].</p>
</div>
<div class="paragraph">
<p>In this way, developers may deploy endpoints in such a way that only one
instance of the endpoint class is instantiated for all the client
connections to the logical endpoints. In this case, developers are
cautioned that such a 'singleton' instance of the endpoint class will
have to program with concurrent calling threads in mind, for example, if
two different clients send a message at the same time.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="client-configuration"><a class="anchor" href="#client-configuration"></a>3.2. Client Configuration</h3>
<div class="paragraph">
<p>In order to connect a WebSocket client endpoint to its corresponding
WebSocket server endpoint, the implementation requires configuration
information. Aside from the list of encoders and decoders, the Jakarta
WebSocket API needs the following attributes:</p>
</div>
<div class="sect3">
<h4 id="subprotocols"><a class="anchor" href="#subprotocols"></a>3.2.1. Subprotocols</h4>
<div class="paragraph">
<p>The default client configuration uses the developer provided list of
subprotocols, to send in order of preference, the names of the
subprotocols it would like to use in the opening handshake it
formulates [WSC-3.2.1-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="extensions"><a class="anchor" href="#extensions"></a>3.2.2. Extensions</h4>
<div class="paragraph">
<p>The default client configuration must use the developer provided list of
extensions to send, in order of preference, the extensions, including
parameters, that it would like to use in the opening handshake it
formulates [WSC-3.2.2-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="client-configuration-modification"><a class="anchor" href="#client-configuration-modification"></a>3.2.3. Client Configuration Modification</h4>
<div class="paragraph">
<p>Some clients may wish to adapt the way in which the client side
formulates the opening handshake interaction with the server. Developers
may provide their own implementations of
ClientEndpointConfig.Configurator which override the default behavior of
the underlying implementation in order to customize it to suit a
particular application’s needs.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="annotations"><a class="anchor" href="#annotations"></a>4. Annotations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains a full specification of the semantics of the
annotations in the Jakarta WebSocket API.</p>
</div>
<div class="sect2">
<h3 id="serverendpoint"><a class="anchor" href="#serverendpoint"></a>4.1. @ServerEndpoint</h3>
<div class="paragraph">
<p>This class level annotation signifies that the Java class it decorates
must be deployed by the implementation as a WebSocket server endpoint
and made available in the URI-space of the WebSocket implementation
[WSC-4.1-1]. The class must be public, concrete, and have a public
no-args constructor. The class may or may not be final, and may or may
not have final methods.</p>
</div>
<div class="sect3">
<h4 id="value"><a class="anchor" href="#value"></a>4.1.1. value</h4>
<div class="paragraph">
<p>The <strong>value</strong> attribute must be a Java string that is a partial URI or
URI-template (level-1), with a leading '/'. For a definition of
URI-templates, see RFC 6570 (Gregorio et al. 2012). The implementation uses the
value attribute to deploy the endpoint to the URI space of the WebSocket
implementation. The implementation must treat the value as relative to
the root URI of the WebSocket implementation in determining a match
against the request URI of an incoming opening handshake request
[WSC-4.1.1-2]. The semantics of matching for annotated endpoints is the
same as was defined in the previous chapter. The value attribute is
mandatory; the implementation must reject a missing or malformed path at
deployment time [WSC-4.1.1-3].</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/bookings/{guest-id}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookingServer</span> {
    <span class="annotation">@OnMessage</span>
    <span class="directive">public</span> <span class="type">void</span> processBookingRequest(
        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">guest-id</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> guestID,
        <span class="predefined-type">String</span> message,
        Session session) {
        <span class="comment">// process booking from the given guest here</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, a client will be able to connect to this endpoint with any
of the URIs</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>/bookings/JohnSmith</strong></p>
</li>
<li>
<p><strong>/bookings/SallyBrown</strong></p>
</li>
<li>
<p><strong>/bookings/MadisonWatson</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, were the endpoint annotation to be
<strong>@ServerEndpoint("/bookings/SallyBrown")</strong>, then only a client
request to <strong>/bookings/SallyBrown</strong> would be able to connect to this
WebSocket endpoint.</p>
</div>
<div class="paragraph">
<p>If URI-templates are used in the value attribute, the developer may
retrieve the variable path segments using the <strong>@PathParam</strong> annotation,
as described below.</p>
</div>
<div class="paragraph">
<p>Applications that contain more than one annotated endpoint may
inadvertently use the same relative URI. The WebSocket implementation
must reject such an application at deployment time with an informative
error message that there is a duplicate path that it cannot resolve [WSC-4.1.1-4].</p>
</div>
<div class="paragraph">
<p>Applications may contain an endpoint mapped to a path that is an
expanded form of a URI template that is used by another endpoint in the
same application. In this case, the application is valid. Please refer
to the previous chapter for a definition of how to resolve the best
match in this type of situation.</p>
</div>
<div class="paragraph">
<p>Future versions of the specification may allow higher levels of
URI-templates.</p>
</div>
</div>
<div class="sect3">
<h4 id="encoders"><a class="anchor" href="#encoders"></a>4.1.2. encoders</h4>
<div class="paragraph">
<p>The <strong>encoders</strong> attribute contains a (possibly empty) list of Java
classes that are to act as encoder components for this endpoint. These
classes must implement some form of the <strong>Encoder</strong> interface, have
public no-arg constructors and be visible within the classpath of the
application that this WebSocket endpoint is part of. The implementation
must create a new instance of each encoder per connection per endpoint
which guarantees no two threads are in the encoder at the same time. When
sending an application object using the <strong>RemoteEndpoint</strong> API that is of a
type that matches (same class or a sub-class) the parameterized type of
the Encoder, the implementation must attempt to encode the object using
the matching Encoder [WSC-4.1.2-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="decoders"><a class="anchor" href="#decoders"></a>4.1.3. decoders</h4>
<div class="paragraph">
<p>The <strong>decoders</strong> attribute contains a (possibly empty) list of Java
classes that are to act as decoder components for this endpoint. These
classes must implement some form of the <strong>Decoder</strong> interface, have
public no-arg constructors and be visible within the classpath of the
application that this WebSocket endpoint is part of. The implementation
must create a new instance of each encoder per connection per endpoint.
The implementation must attempt to decode WebSocket messages using the
decoder in the list appropriate to the native WebSocket message type and
pass the message in decoded object form to the WebSocket endpoint
[WSC-4.1.3-1]. On <strong>Decoder</strong> implementations that have it, the
implementation must use the <strong>willDecode()</strong> method on the decoder to
determine if the <strong>Decoder</strong> will match the incoming message [WSC-4.1.3-2].</p>
</div>
</div>
<div class="sect3">
<h4 id="subprotocols-1"><a class="anchor" href="#subprotocols-1"></a>4.1.4. subprotocols</h4>
<div class="paragraph">
<p>The <strong>subprotocols</strong> parameter contains a (possibly empty) list of string
names of the subprotocols that this endpoint supports. The
implementation must use this list in the opening handshake to negotiate
the desired subprotocol to use for the connection it establishes
[WSC-4.1.4-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="configurator"><a class="anchor" href="#configurator"></a>4.1.5. configurator</h4>
<div class="paragraph">
<p>The optional configurator attribute allows the developer to indicate
that they would like the WebSocket implementation to use a developer
provided implementation of <strong>ServerEndpointConfig.Configurator</strong>. If one
is supplied, the WebSocket implementation must use this when configuring
the endpoint [WSC-4.1.5-1]. The developer may use this technique to
share state across all instances of the endpoint in addition to
customizing the opening handshake.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clientendpoint"><a class="anchor" href="#clientendpoint"></a>4.2. @ClientEndpoint</h3>
<div class="paragraph">
<p>This class level annotation signifies that the Java class it decorates
is to be deployed as a WebSocket client endpoint that will connect to a
WebSocket endpoint residing on a WebSocket server. The class must have a
public no-args constructor, and additionally may conform to one of the
types listed in <a href="#jakartaee">Chapter 7</a>.</p>
</div>
<div class="sect3">
<h4 id="encoders-1"><a class="anchor" href="#encoders-1"></a>4.2.1. encoders</h4>
<div class="paragraph">
<p>The <strong>encoders</strong> parameter contains a (possibly empty) list of Java
classes that are to act as encoder components for this endpoint. These
classes must implement some form of the <strong>Encoder</strong> interface, have
public no-arg constructors and be visible within the classpath of the
application that this WebSocket endpoint is part of. The implementation
must create a new instance of each encoder per connection per endpoint
which guarantees no two threads are in the encoder at the same time. When
sending an application object using the <strong>RemoteEndpoint</strong> API that is of a
type that matches (same class or a sub-class) the parameterized type of
the Encoder, the implementation must attempt to encode the object using
the matching Encoder[WSC-4.2.1-1].</p>
</div>
</div>
<div class="sect3">
<h4 id="decoders-1"><a class="anchor" href="#decoders-1"></a>4.2.2. decoders</h4>
<div class="paragraph">
<p>The <strong>decoders</strong> parameter contains a (possibly empty) list of Java
classes that are to act as decoder components for this endpoint. These
classes must implement some form of the Decoder interface, have
public no-arg constructors and be visible within the classpath of the
application that this WebSocket endpoint is part of. The implementation
must create a new instance of each encoder per connection per endpoint.
The implementation must attempt to decode WebSocket messages using the
first appropriate decoder in the list and pass the message in decoded
object form to the WebSocket endpoint [WSC-4.2.2-1]. If the Decoder
implementation has the method, the implementation must use the
<strong>willDecode()</strong> method on the decoder to determine if the <strong>Decoder</strong> will
match the incoming message [WSC-4.2.2-2].</p>
</div>
</div>
<div class="sect3">
<h4 id="configurator-1"><a class="anchor" href="#configurator-1"></a>4.2.3. configurator</h4>
<div class="paragraph">
<p>The optional <strong>configurator</strong> attribute allows the developer to indicate
that they would like the WebSocket implementation to use a developer
provided implementation of <strong>ClientEndpointConfig.Configurator</strong>. If one
is supplied, the WebSocket implementation must use this when configuring
the endpoint [4.2.3-1]. The developer may use this technique to share
state across all instances of the endpoint in addition to customizing
the opening handshake.</p>
</div>
</div>
<div class="sect3">
<h4 id="subprotocols-2"><a class="anchor" href="#subprotocols-2"></a>4.2.4. subprotocols</h4>
<div class="paragraph">
<p>The <strong>subprotocols</strong> parameter contains a (possibly empty) list of string
names of the subprotocols that this endpoint is willing to support. The
implementation must use this list in the opening handshake to negotiate
the desired subprotocol to use for the connection it establishes
[WSC-4.2.4-1].</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pathparam"><a class="anchor" href="#pathparam"></a>4.3. @PathParam</h3>
<div class="paragraph">
<p>This annotation is used to annotate one or more parameters of methods on
an annotated endpoint class decorated with any of the annotations
<strong>@OnMessage</strong>, <strong>@OnError</strong>, <strong>@OnOpen</strong>, <strong>@OnClose</strong>. The allowed
types for these parameters are String, any Java primitive type, or boxed
version thereof. Any other type annotated with this annotation is an
error that the implementation must report at deployment time
[WSC-4.3-1]. The <strong>value</strong> attribute of this annotation must be present
otherwise the implementation must throw an error [WSC-4.3-2]. If the
<strong>value</strong> attribute of this annotation matches the variable name of an
element of the URI-template used in the <strong>@ServerEndpoint</strong> annotation
that annotates this annotated endpoint, then the implementation must
associate the value of the parameter it annotates with the value of the
path segment of the request URI to which the calling WebSocket frame is
connected when the method is called [WSC-4.3-3]. Otherwise, the value of
the String parameter annotated by this annotation must be set to <strong>null</strong>
by the implementation. The association must follow these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the parameter is a <strong>String</strong>, the container must use the value of
the path segment [WSC-4.3-4].</p>
</li>
<li>
<p>if the parameter is a Java primitive type or boxed version thereof, the
container must use the path segment string to construct the type with
the same result as if it had used the public one argument String
constructor to obtain the boxed type, and reduced to its primitive type
if necessary [WSC-4.3-5].</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the container cannot decode the path segment appropriately to the
annotated path parameter, then the container must raise an
<strong>DecodeException</strong> to the error handling method of the WebSocket
containing the path segment [WSC-4.3-6].</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/bookings/{guest-id}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookingServer</span> {
    <span class="annotation">@OnMessage</span>
    <span class="directive">public</span> <span class="type">void</span> processBookingRequest(
        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">guest-id</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> guestID,
        <span class="predefined-type">String</span> message,
        Session session) {
        <span class="comment">// process booking from the given guest here</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, if a client connects to this endpoint with the URI
<strong>/bookings/JohnSmith</strong>, then the value of the <strong>guestID</strong> parameter will
be <strong>"JohnSmith"</strong>.</p>
</div>
<div class="paragraph">
<p>Here is an example where the path parameter is an Integer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ServerEndpoint</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/rewards/{vip-level}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RewardServer</span> {
    <span class="annotation">@OnMessage</span>
    <span class="directive">public</span> <span class="type">void</span> processReward(
        <span class="annotation">@PathParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">vip-level</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">Integer</span> vipLevel,
        <span class="predefined-type">String</span> message, Session session) {
        <span class="comment">// process reward here</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="onopen"><a class="anchor" href="#onopen"></a>4.4. @OnOpen</h3>
<div class="paragraph">
<p>This annotation may be used on certain methods of a Java class annotated
with <strong>@ServerEndpoint</strong> or <strong>@ClientEndpoint</strong>. The annotation defines
that the decorated method be called whenever a new client has connected
to this endpoint. The container notifies the method after the connection
has been established [WSC-4.4-1]. The decorated method can only have an
optional <strong>Session</strong> parameter, an optional <strong>EndpointConfig</strong> parameter and
zero to n parameters (of type <strong>String</strong>, any Java primitive type, or boxed
version thereof) annotated with a <strong>@PathParam</strong> annotation
as parameters. If the <strong>Session</strong> parameter is present, the implementation
must pass in the newly created <strong>Session</strong> corresponding to the new
connection [WSC-4.4-2].</p>
</div>
<div class="paragraph">
<p>Any Java class using this annotation on a method that does not follow
these rules, or that uses this annotation on more than one method must
not be deployed by the implementation and the error must be reported to
the deployer [WSC-4.4-3].</p>
</div>
</div>
<div class="sect2">
<h3 id="onclose"><a class="anchor" href="#onclose"></a>4.5. @OnClose</h3>
<div class="paragraph">
<p>This annotation may be used on certain methods of a Java class annotated
with <strong>@ServerEndpoint</strong> or <strong>@ClientEndpoint</strong>. The annotation defines
that the decorated method be called whenever a remote peer is about to
be disconnected from this endpoint, whether that process is initiated by
the remote peer, by the local container or by a call to
<strong>session.close()</strong>. The container notifies the method before the
connection is brought down [WSC-4.5-1]. The decorated method can only
have optional <strong>Session</strong> parameter, optional <strong>CloseReason</strong> parameter and
zero to n parameters (of type <strong>String</strong>, any Java primitive type, or boxed
version thereof) annotated with a <strong>@PathParam</strong> annotation
as parameters. If the <strong>Session</strong> parameter is present, the implementation
must pass in the about-to-be ended <strong>Session</strong> corresponding to the
connection [WSC-4.5-2]. If the method itself throws an error, the
implementation must pass this error to the <strong>onError()</strong> method of the
endpoint together with the session [WSC-4.5-3].</p>
</div>
<div class="paragraph">
<p>Any Java class using this annotation on a method that does not follow
these rules, or that uses this annotation on more than one method must
not be deployed by the implementation and the error must be reported to
the deployer [WSC-4.5-4].</p>
</div>
</div>
<div class="sect2">
<h3 id="onerror"><a class="anchor" href="#onerror"></a>4.6. @OnError</h3>
<div class="paragraph">
<p>This annotation may be used on certain methods of a Java class annotated
with <strong>@ServerEndpoint</strong> or <strong>@ClientEndpoint</strong>. The annotation defines
that the decorated method be called whenever an error is generated on
any of the connections to this endpoint. The decorated method can only
have optional <strong>Session</strong> parameter, mandatory <strong>Throwable</strong> parameter and
zero to n parameters (of type <strong>String</strong>, any Java primitive type, or boxed
version thereof) annotated with a <strong>@PathParam</strong> annotation
as parameters. If the <strong>Session</strong> parameter is present, the implementation
must pass in the <strong>Session</strong> in which the error occurred to the connection
[WSC-4.6-1]. The container must pass the error as the <strong>Throwable</strong>
parameter to this method [WSC-4.6-2].</p>
</div>
<div class="paragraph">
<p>Any Java class using this annotation on a method that does not follow
these rules, or that uses this annotation on more than one method must
not be deployed by the implementation and the error must be reported to
the deployer [WSC-4.6-3].</p>
</div>
</div>
<div class="sect2">
<h3 id="onmessage"><a class="anchor" href="#onmessage"></a>4.7. @OnMessage</h3>
<div class="paragraph">
<p>This annotation may be used on certain methods of a Java class annotated
with <strong>@ServerEndpoint</strong> or <strong>@ClientEndpoint</strong>. The annotation defines
that the decorated method be called whenever an incoming message is
received. The method it decorates may have a number of forms for
handling text, binary or pong messages, and for sending a message back
immediately that are defined in detail in the API documentation for
<strong>@OnMessage</strong>.</p>
</div>
<div class="paragraph">
<p>Any method annotated with <strong>@OnMessage</strong> that does not conform to the
forms defied therein is invalid. The WebSocket implementation must not
deploy such an endpoint and must raise a deployment error if an attempt
is made to deploy such an annotated endpoint [WSC-4.7-1].</p>
</div>
<div class="paragraph">
<p>If the method uses a class equivalent of a Java primitive as a method
parameter to handle whole text messages, the implementation must use the
single String parameter constructor to attempt construct the object. If
the method uses a Java primitive as a method parameter to handle whole
text messages, the implementation must attempt to construct its class
equivalent as described above, and then convert it to its primitive
value [WSC-4.7-2].</p>
</div>
<div class="paragraph">
<p>If the method uses a Java primitive as a return value, the
implementation must construct the text message to send using the
standard Java string representation of the Java primitive. If the method
uses a class equivalent of a Java primitive as a return value, the
implementation must construct the text message from the Java primitive
equivalent as just described [WSC-4.7-3].</p>
</div>
<div class="paragraph">
<p>Each WebSocket endpoint may only have one message handling method for
each of the native WebSocket message formats: text, binary and pong. Any
WebSocket endpoint that defines more than one message handling method
for any of the native WebSocket message formats is invalid. The
WebSocket implementation must not deploy such an endpoint and must raise
a deployment error if an attempt is made to deploy such an annotated
endpoint [WSC-4.7-4].</p>
</div>
<div class="sect3">
<h4 id="maxmessagesize"><a class="anchor" href="#maxmessagesize"></a>4.7.1. maxMessageSize</h4>
<div class="paragraph">
<p>The maxMessageSize attribute allows the developer to specify the maximum
size of message in bytes that the method it annotates will be able to
process, or <code>-1</code> to indicate that there is no maximum. The
default is <code>-1</code>.</p>
</div>
<div class="paragraph">
<p>If an incoming message exceeds the maximum message size, the
implementation must formally close the connection with a close code of
<code>1009</code> (Too Big) [WSC-4.7.1-1].</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="websockets-and-inheritance"><a class="anchor" href="#websockets-and-inheritance"></a>4.8. WebSockets and Inheritance</h3>
<div class="paragraph">
<p>The WebSocket annotation behaviors defined by this specification are not
passed down the Java class inheritance hierarchy. They apply only to the
Java class on which they are marked. For example, a Java class that
inherits from a Java class annotated with class level WebSocket
annotations does not itself become an annotated endpoint, unless it
itself is annotated with a class level WebSocket annotation. Similarly,
subclasses of an annotated endpoint may not use method level WebSocket
annotations unless they themselves use a class level WebSocket
annotation. Subclasses that override methods annotated with WebSocket
method annotations do not obtain WebSocket callbacks unless those
subclass methods themselves are marked with a method level WebSocket
annotation.</p>
</div>
<div class="paragraph">
<p>Implementations should not deploy Java classes that mistakenly mix Java
inheritance with WebSocket annotations in these ways [WSC-4.8.1].</p>
</div>
<div class="paragraph">
<p>Implementations that use archive scanning techniques to deploy endpoints
on startup must filter out subclasses of annotated endpoints, in
addition to other errent endpoint definitions such as annotated classes
that are non-public when they build the list of annotated endpoints to
deploy [WSC-4.8.2].</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exception-handling-and-threading"><a class="anchor" href="#exception-handling-and-threading"></a>5. Exception handling and Threading</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="threading-considerations"><a class="anchor" href="#threading-considerations"></a>5.1. Threading Considerations</h3>
<div class="paragraph">
<p>Implementations of the WebSocket API may employ a variety of threading
strategies in order to provide a scalable implementation. The
specification aims to allow a range of strategies. However, the
implementation must fulfill certain threading requirements in order to
provide the developer a consistent threading environment for their
applications.</p>
</div>
<div class="paragraph">
<p>Unless backed by a Jakarta EE component with a different lifecycle (See
<a href="#jakartaee">Chapter 7</a>), the container must use a unique instance of the
endpoint per peer [WSC-5.1-1]. In all cases, the implementation must not
invoke an endpoint instance with more than one thread per peer at a
time [WSC-5.1-2]. The implementation may not invoke the close method on
an endpoint until after the open method has completed [WSC-5.1-3].</p>
</div>
<div class="paragraph">
<p>This guarantees that a WebSocket endpoint instance is never called by
more than one container thread at a time per peer [WSC-5.1-4].</p>
</div>
<div class="paragraph">
<p>If the implementation decides to process an incoming message in parts,
it must ensure that the corresponding <strong>onMessage()</strong> calls are called
sequentially, and do not interleave either with parts of the same
message or with other messages [WSC-5.1.5].</p>
</div>
</div>
<div class="sect2">
<h3 id="exception:error"><a class="anchor" href="#exception:error"></a>5.2. Error Handling</h3>
<div class="paragraph">
<p>There are three categories of errors (checked and unchecked Java
exceptions) that this specification defines.</p>
</div>
<div class="sect3">
<h4 id="deployment-errors"><a class="anchor" href="#deployment-errors"></a>5.2.1. Deployment Errors</h4>
<div class="paragraph">
<p>These are errors raised during the deployment of an application
containing WebSocket endpoints. Some of these errors arise as the result
of a container malfunction during the deployment of the application. For
example, the container may not have sufficient computing resources to
deploy the application as specified. In this case, the container must
provide an informative error message to the developer during the
deployment process [WSC-5.2.1-1]. Other errors arise as a result of a
malformed WebSocket application. <a href="#annotations">Chapter 4</a> provides several
examples of WebSocket endpoints that are malformed. In such cases, the
container must provide an informative error message to the deployer
during the deployment process [WSC-5.2.1-2].</p>
</div>
<div class="paragraph">
<p>In both cases, a deployment error raised during the deployment process
must halt the deployment of the application, any well formed endpoints
deployed prior to the error being raised must be removed from service
and no more WebSocket endpoints from that application may be deployed by
the container, even if they are valid [WSC-5.2.1-3].</p>
</div>
<div class="paragraph">
<p>If the deployment error occurs under the programmatic control of the
developer, for example, when using the WebSocketContainer API to deploy
a client endpoint, deployment errors must be reported by the container
to the developer by using an instance of the DeploymentException
[WSC-5.2.1-4]. Containers may choose the precise wording of the error
message in such cases.</p>
</div>
<div class="paragraph">
<p>If the deployment error occurs while deployment is managed by the
implementation, for example, as a result of deploying a WAR file where
the endpoints are deployed by the container as a result of scanning the
WAR file, the deployment error must be reported to the deployer by the
implementation as part of the container specific deployment process [WSC-5.2.1-5].</p>
</div>
</div>
<div class="sect3">
<h4 id="errors-originating-in-websocket-application-code"><a class="anchor" href="#errors-originating-in-websocket-application-code"></a>5.2.2. Errors Originating in WebSocket Application Code</h4>
<div class="paragraph">
<p>All errors arising during the functioning of a WebSocket endpoint must
be caught by the WebSocket implementation [WSC-5.2.2-1]. Examples of
these errors include checked exceptions generated by <strong>Decoders</strong> used by
the endpoint and runtime errors generated in the message handling code used
by the endpoint. If the WebSocket endpoint has provided an error
handling method, either by implementing the <strong>onError()</strong> method in the
case of programmatic endpoints, or by using the @OnError annotation in
the case of annotated endpoints, the implementation must invoke the
error handling method with the error [WSC-5.2.2-2].</p>
</div>
<div class="paragraph">
<p>If the developer has not provided an error handling method on an
endpoint that is generating errors, this indicates to the implementation
that the developer does not wish to handle such errors. In these cases,
the container must make this information available for later analysis,
for example by logging it [WSC-5.2.2-3].</p>
</div>
<div class="paragraph">
<p>If the error handling method of an endpoint itself is generating runtime
errors, the container must make this information available for later
analysis [WSC-5.2.2-4].</p>
</div>
</div>
<div class="sect3">
<h4 id="errors-originating-in-the-container-andor-underlying-connection"><a class="anchor" href="#errors-originating-in-the-container-andor-underlying-connection"></a>5.2.3. Errors Originating in the Container and/or Underlying Connection</h4>
<div class="paragraph">
<p>A wide variety of runtime errors may occur during the functioning of an
endpoint. These may including broken underlying connections, occasional
communication errors handling incoming and outgoing messages, or fatal
errors communicating with a peer. Implementations or their
administrators judging such errors to be fatal to the correct
functioning of the endpoint may close the endpoint connection, making an
attempt to informing both participants using the <strong>onClose()</strong> method.
Containers judging such errors to be non-fatal to the correct
functioning of the endpoint may allow the endpoint to continue
functioning, but must report the error in message processing either as a
checked exception returned by one of the send operations, or by
delivering a SessionException to the endpoint’s error handling
method, if present, or by logging the error for later analysis [WSC-5.2.3-1].</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="packaging-and-deployment"><a class="anchor" href="#packaging-and-deployment"></a>6. Packaging and Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jakarta WebSocket applications are packaged using the usual conventions of
the Jakarta and Java platforms.</p>
</div>
<div class="sect2">
<h3 id="client-deployment-on-jdk"><a class="anchor" href="#client-deployment-on-jdk"></a>6.1. Client Deployment on JRE</h3>
<div class="paragraph">
<p>The class files for the WebSocket application and any application
resources such as Jakarta WebSocket client applications are packaged as JAR
files, along with any resources such as text or image files that it
needs.</p>
</div>
<div class="paragraph">
<p>The client container is not required to automatically scan the JAR file
for WebSocket client endpoints and deploy them.</p>
</div>
<div class="paragraph">
<p>Obtaining a reference to the <strong>WebSocketContainer</strong> using the
<strong>ContainerProvider</strong> class, the developer deploys both programmatic
endpoints and annotated endpoints using the <strong>connectToServer()</strong> APIs on
the <strong>WebSocketContainer</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="application-deployment-on-web-containers"><a class="anchor" href="#application-deployment-on-web-containers"></a>6.2. Application Deployment on Web Containers</h3>
<div class="paragraph">
<p>The class files for the endpoints and any resources they need such as
text or image files are packaged into the Jakarta EE-defined WAR file,
either directly under <strong>WEB-INF/classes</strong> or packaged as a JAR file and
located under <strong>WEB-INF/lib</strong>.</p>
</div>
<div class="paragraph">
<p>Jakarta EE containers are not required to support deployment of WebSocket
endpoints if they are not packaged in a WAR file as described above.</p>
</div>
<div class="paragraph">
<p>The Jakarta WebSocket implementation must use the web container scanning
mechanism defined in Servlet 3.0 to find annotated and programmatic
endpoints contained within the WAR file at deployment time [WSC-6.2-1].
This is done by scanning for classes annotated with <strong>@ServerEndpoint</strong>
and classes that extend <strong>Endpoint</strong>. See also
<a href="#websockets-and-inheritance">Section 4.8</a> for potential
extra steps needed after the scan for annotated endpoints. Further, the
WebSocket implementation must use the WebSocket scanning mechanism to
find implementations of the <strong>ServerApplicationConfig</strong> interface packaged
within the WAR file (or in any of its sub-JAR files) [WSC-6.2-2].</p>
</div>
<div class="paragraph">
<p>If scan of the WAR file locates one or more <strong>ServerApplicationConfig</strong>
implementations, the WebSocket implementation must instantiate each of
the <strong>ServerApplicationConfig</strong> classes it found. For each one, it must
pass the results of the scan of the archive containing it (top level WAR
or contained JAR) to its methods [WSC-6.2-4]. The set that is the union
of all the results obtained by calling the <strong>getEndpointConfigs()</strong> and
<strong>getAnnotatedEndpointClasses()</strong> on the <strong>ServerApplicationConfig</strong> classes
(that is to say, the annotated endpoint classes and configuration
objects for programmatic endpoints) is the set that the WebSocket
implementation must deploy [WSC-6.2-5].</p>
</div>
<div class="paragraph">
<p>If the WAR file contains no <strong>ServerApplicationConfig</strong> implementations,
it must deploy all the annotated endpoints it located as a result of the
scan [WSC-6.2-3]. Because programmatic endpoints cannot be deployed
without a corresponding <strong>ServerEndpointConfig</strong>, if there are no
<strong>ServerApplicationConfig</strong> implementations to provide these configuration
objects, no programmatic endpoints can be deployed.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> <em>This means developers can easily deploy all the annotated endpoints in a
WAR file by simply bundling the class files for them into the WAR. This
also means that programmatic endpoints cannot be deployed using this
scanning mechanism unless a suitable <strong>ServerApplicationConfig</strong> is
supplied. This also means that the developer can have precise control
over which endpoints are to be deployed from a WAR file by providing one
or more <strong>ServerApplicationConfig</strong> implementation classes. This also
allows the developer to limit a potentially lengthy scanning process by
excluding certain JAR files from the scan (see Servlet 3.0, section
8.2.1). This last case may be desirable in the case of a WAR file
containing many JAR files that the developer knows do not contain any
WebSocket endpoints.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="application-deployment-in-standalone-websocket-server-containers"><a class="anchor" href="#application-deployment-in-standalone-websocket-server-containers"></a>6.3. Application Deployment in Standalone WebSocket Server Containers</h3>
<div class="paragraph">
<p>This specification recommends standalone WebSocket server containers
(i.e. those that do not include a Servlet container) locate any
WebSocket server endpoints and <strong>ServerApplicationConfig</strong> classes in the
application bundle and deploy the set of all the server endpoints
returned by the configuration classes. However, standalone WebSocket
server containers may employ other implementation techniques to deploy
endpoints if they wish.</p>
</div>
</div>
<div class="sect2">
<h3 id="programmatic-server-deployment"><a class="anchor" href="#programmatic-server-deployment"></a>6.4. Programmatic Server Deployment</h3>
<div class="paragraph">
<p>This specification also defines a mechanism for deployment of server
endpoints that does not depend on Servlet container scanning of the
application. Developers may deploy server endpoints programmatically by
using one of the <strong>addEndpoint</strong> methods of the <strong>ServerContainer</strong>
interface. These methods are only operational during the application
deployment phase of an application. Specifically, as soon as any of the
server endpoints within the application have accepted an opening
handshake request, the APIs may not longer be used. This restriction may
be relaxed in a future version.</p>
</div>
<div class="paragraph">
<p>When running on the web container, the <strong>addEndpoint</strong> methods may be
called from a <strong>jakarta.servlet.ServletContextListener</strong> provided by the
developer and configured in the deployment descriptor of the web
application. The WebSocket implementation must make the
<strong>ServerContainer</strong> instance corresponding to this application available
to the developer as a <strong>ServletContext</strong> attribute registered under the
name <strong>jakarta.websocket.server.ServerContainer</strong>.</p>
</div>
<div class="paragraph">
<p>When running on a standalone container, the application deployment phase
is undefined, so the developer will need to utilize whatever proprietary
deployment time hooks the particular container has to offer in order to
make a <strong>ServerContainer</strong> instance available to the developer at this
time.</p>
</div>
<div class="paragraph">
<p>It is recommended that developers use either the programmatic deployment
API, or base their application on the scanning and
<strong>ServerApplicationConfig</strong> mechanism, but not mix both methods.
Developers can suppress a deployment by scan of the endpoints in the WAR
file by providing a <strong>ServerApplicationConfig</strong> that returns empty sets
from its methods.</p>
</div>
<div class="paragraph">
<p>If however, the developer does mix both modes of deployment, it is
possible in the case of annotated endpoints, for the same annotated
endpoint to be submitted twice for deployment, once as a result of a
scan of the WAR file, and once by means of the developer calling the
programmatic deployment API. In this case of an attempt to deploy the
same annotated endpoint class more than once, the WebSocket
implementation must only deploy the annotated endpoint once, and ignore
the duplicate submission.</p>
</div>
</div>
<div class="sect2">
<h3 id="websocket-server-paths"><a class="anchor" href="#websocket-server-paths"></a>6.5. WebSocket Server Paths</h3>
<div class="paragraph">
<p>WebSocket implementations that include server functionality must define
a root or the URI space for WebSockets. Called the the WebSocket root,
it is the URI to which all the relative WebSocket paths in the same
application are relative. If the WebSocket server does not include the
Servlet API, the WebSocket server may choose WebSocket root itself. If
the WebSocket server includes the Jakarta Servlet API, the WebSocket root
must be the same as the Servlet context root of the web application
[WSC-6.4-1].</p>
</div>
</div>
<div class="sect2">
<h3 id="platform-versions"><a class="anchor" href="#platform-versions"></a>6.6. Platform Versions</h3>
<div class="paragraph">
<p>The minimum versions of the platforms are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java SE version 8, for the Jakarta WebSocket Client API [WSC-6.5-1].</p>
</li>
<li>
<p>Jakarta EE version 9, for the Jakarta WebSocket Server API [WSC-6.5-2].</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jakartaee"><a class="anchor" href="#jakartaee"></a>7. Jakarta EE Environment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="jakarta-ee-environment"><a class="anchor" href="#jakarta-ee-environment"></a>7.1. Jakarta EE Environment</h3>
<div class="paragraph">
<p>When supported on the Jakarta EE platform, there are some additional
requirements to support WebSocket applications.</p>
</div>
<div class="sect3">
<h4 id="websocket-endpoints-and-dependency-injection"><a class="anchor" href="#websocket-endpoints-and-dependency-injection"></a>7.1.1. WebSocket Endpoints and Dependency Injection</h4>
<div class="paragraph">
<p>WebSocket endpoints running in the Jakarta EE platform must have full
dependency injection support as described in the CDI specification (Muir
2013). WebSocket implementations part of the Jakarta EE platform are
required to support field, method, and constructor injection using the
jakarta.inject.Inject annotation into all WebSocket endpoint classes, as
well as the use of interceptors for these classes [WSC-7.1.1-1]. The
details of this requirement are laid out in the Jakarta EE Platform
Specification (DeMichiel and Shannon 2013), section EE.5.2.5, and a
useful guide for implementations to meet the requirement is location in
section EE.5.24.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jakartaee:httpsession"><a class="anchor" href="#jakartaee:httpsession"></a>7.2. Relationship with Http Session and Authenticated State</h3>
<div class="paragraph">
<p>It is often useful for developers who embed WebSocket server endpoints
into a larger web application to be able to share information on a per
client basis between the web resources (JSPs, JSFs, Servlets for
example) and the WebSocket endpoints servicing that client. Because
WebSocket connections are initiated with an http request, there is an
association between the HttpSession under which a client is operating
and any WebSockets that are established within that <strong>HttpSession</strong>. The
API allows access in the opening handshake to the unique <strong>HttpSession</strong>
corresponding to that same client [WSC-7.2-1].</p>
</div>
<div class="paragraph">
<p>Similarly, if the opening handshake request is already authenticated
with the server, the opening handshake API allows the developer to query
the user <strong>Principal</strong> of the request. If the connection is established
with the requesting client, the WebSocket implementation considers the
user <strong>Principal</strong> for the associated WebSocket <strong>Session</strong> to be the user
<strong>Principal</strong> that was present on the opening handshake [WSC-7.2-2].</p>
</div>
<div class="paragraph">
<p>In the case where a WebSocket endpoint is a protected resource in the
web application (see <a href="#security">Chapter 8</a>), that is to say, requires an
authorized user to access it, then the WebSocket implementation must
ensure that the WebSocket endpoint does not remain connected to its peer
after the underlying implementation has decided the authenticated
identity is no longer valid [WSC-7.2-3]. This may happen, for example,
if the user logs out of the containing web application, or if the
authentication times out or is invalidated for some other reason. In
this situation, the WebSocket implementation must immediately close the
connection using the WebSocket close status code 1008 [WSC-7.2-3].</p>
</div>
<div class="paragraph">
<p>On the other hand, if the WebSocket endpoint is not a protected resource
in the web application, then the user identity under which an opening
handshake established the connection may become invalid or change during
the operation of the WebSocket without the WebSocket implementation
needing to close the connection.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security"><a class="anchor" href="#security"></a>8. Server Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>WebSocket endpoints are secured using the web container security model.
The goal of this is to make it easy for a WebSocket developer to declare
whether access to a WebSocket server endpoint needs to be authenticated,
who can access it, and if it needs an encrypted connection or not. A
WebSocket which is mapped to a given <strong>ws://</strong> URI (as described in
<a href="#configuration">Chapter 3</a> and <a href="#annotations">Chapter 4</a>) is protected in the
deployment descriptor with a listing to a <strong>http://</strong> URI with same
hostname, port and path since this is the URL of its opening handshake.
Accordingly, WebSocket developers may assign an authentication scheme,
user roles granted access and transport guarantee to their WebSocket
endpoints.</p>
</div>
<div class="sect2">
<h3 id="authentication-of-websockets"><a class="anchor" href="#authentication-of-websockets"></a>8.1. Authentication of Websockets</h3>
<div class="paragraph">
<p>This specification does not define a mechanism by which WebSockets
themselves can be authenticated. Rather, by building on the Servlet
defined security mechanism, a WebSocket that requires authentication
must rely on the opening handshake request that seeks to initiate a
connection to be previously authenticated. Typically, this will be
performed by an HTTP authentication (perhaps basic or form-based) in the
web application containing the WebSocket prior to the opening handshake
to the WebSocket.</p>
</div>
<div class="paragraph">
<p>If a client sends an unauthenticated opening handshake request for a
WebSocket that is protected by the security mechanism, the WebSocket
implementation must return a <strong>401 (Unauthorized)</strong> response to the
opening handshake request and may not initiate a WebSocket connection
[WSC-8.1-1].</p>
</div>
</div>
<div class="sect2">
<h3 id="authorization-of-websockets"><a class="anchor" href="#authorization-of-websockets"></a>8.2. Authorization of Websockets</h3>
<div class="paragraph">
<p>A WebSocket’s authorization may be set by adding a
<strong>&lt;security-constraint&gt;</strong> element to the
<strong>web.xml</strong> of the web application in which it is packaged. The
<strong>&lt;url-pattern&gt;</strong> used in the security
constraint must be used by the container to match the request URI of the
opening handshake of the WebSocket [WSC-8.2-1]. The implementation must
interpret any http-method other than GET (or the default, missing) as
not applying to the WebSocket [WSC-8.2-2].</p>
</div>
</div>
<div class="sect2">
<h3 id="transport-guarantee"><a class="anchor" href="#transport-guarantee"></a>8.3. Transport Guarantee</h3>
<div class="paragraph">
<p>A transport guarantee of <strong>NONE</strong> must be interpreted by the container as
allowing unencrypted <strong>ws://</strong> connections to the WebSocket [WSC-8.3-1]. A
transport guarantee of <strong>CONFIDENTIAL</strong> must be interpreted by the
implementation as only allowing access to the WebSocket over an
encrypted (<strong>wss://</strong>) connection [WSC-8.3-2]. This may require a
pre-authenticated request.</p>
</div>
</div>
<div class="sect2">
<h3 id="example"><a class="anchor" href="#example"></a>8.4. Example</h3>
<div class="paragraph">
<p>This example snippet from a larger web.xml deployment descriptor shows a
security constraint for a WebSocket endpoint. In the example, the
WebSocket endpoint which matches on an incoming request URI of
<strong>'quotes/live'</strong> relative to the context root of the containing web
application is protected such that it may only be accessed using
<strong>wss://</strong>, and is available only to authenticated users who belong
either to the <strong>GOLD_MEMBER</strong> or <strong>PLATINUM_MEMBER</strong> roles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;security-constraint&gt;</span>
    <span class="tag">&lt;web-resource-collection&gt;</span>
        <span class="tag">&lt;web-resource-name&gt;</span>
            LiveQuoteWebSocket
        <span class="tag">&lt;/web-resource-name&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            Security constraint for
            live quote WebSocket endpoint
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/quotes/live<span class="tag">&lt;/url-pattern&gt;</span>
    <span class="tag">&lt;/web-resource-collection&gt;</span>
    <span class="tag">&lt;auth-constraint&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            definition of which roles
            may access the quote endpoint
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>GOLD_MEMBER<span class="tag">&lt;/role-name&gt;</span>
        <span class="tag">&lt;role-name&gt;</span>PLATINUM_MEMBER<span class="tag">&lt;/role-name&gt;</span>
    <span class="tag">&lt;/auth-constraint&gt;</span>
    <span class="tag">&lt;user-data-constraint&gt;</span>
        <span class="tag">&lt;description&gt;</span>WSS required<span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;transport-guarantee&gt;</span>
            CONFIDENTIAL
        <span class="tag">&lt;/transport-guarantee&gt;</span>
    <span class="tag">&lt;/user-data-constraint&gt;</span>
<span class="tag">&lt;/security-constraint&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changes"><a class="anchor" href="#changes"></a>Appendix A: Changes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix lists the changes in the WebSocket specification.
This appendix is non-normative.</p>
</div>
<div class="sect2">
<h3 id="changes-since-jsr-356"><a class="anchor" href="#changes-since-jsr-356"></a>A.1. Changes Between 2.0 and JSR-356</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/eclipse-ee4j/websocket-api/pull/312">Pull Request 312</a>
Convert from <code>javax.*</code> to <code>jakarta.*</code></p>
</li>
<li>
<p><a href="https://github.com/eclipse-ee4j/websocket-api/pull/312">Pull Request 315</a>
Update specification document for move to Jakarta EE</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>plus a large number of smaller tweaks and editorial improvements.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bibliography"><a class="anchor" href="#bibliography"></a>Bibliography</h2>
<div class="sectionbody">
<div class="paragraph">
<p>[1] I. Fette and A. Melnikov. RFC 6455: The WebSocket Protocol. RFC, IETF, December 2011. See
<a href="http://www.ietf.org/rfc/rfc6455.txt" class="bare">http://www.ietf.org/rfc/rfc6455.txt</a>.</p>
</div>
<div class="paragraph">
<p>[2] Ian Hickson. The WebSocket API. Note, W3C, December 2012. See
<a href="http://dev.w3.org/html5/websockets/" class="bare">http://dev.w3.org/html5/websockets/</a>.</p>
</div>
<div class="paragraph">
<p>[3] S. Bradner. RFC 2119: Keywords for use in RFCs to Indicate Requirement Levels. RFC, IETF, March
1997. See <a href="http://www.ietf.org/rfc/rfc2119.txt" class="bare">http://www.ietf.org/rfc/rfc2119.txt</a>.</p>
</div>
<div class="paragraph">
<p>[4] J. Gregorio, R. Fielding, M. Hadley, M. Nottingham, and D. Orchard. RFC 6570: URI Template. RFC,
IETF, March 2012. See <a href="http://www.ietf.org/rfc/rfc6570.txt" class="bare">http://www.ietf.org/rfc/rfc6570.txt</a>.</p>
</div>
<div class="paragraph">
<p>[5] Pete Muir. Contexts and Dependency Injection for Java EE. JSR, JCP, 2013. See
<a href="http://jcp.org/en/jsr/detail?id=347" class="bare">http://jcp.org/en/jsr/detail?id=347</a>.</p>
</div>
<div class="paragraph">
<p>[6] Linda DeMichiel and Bill Shannon. Java Platform, Enterprise Edition 7 (Java EE 7) Specification.
JSR, JCP, 2013. See <a href="http://jcp.org/en/jsr/detail?id=342" class="bare">http://jcp.org/en/jsr/detail?id=342</a>.</p>
</div>
<div class="paragraph">
<p>[7] T. Berners-Lee, R. Fielding and L. Masinter. RFC 3986: Uniform Resource Identifier
(URI): Generic Syntax, IETF, January 2005.
See <a href="https://tools.ietf.org/rfc/rfc3986.txt" class="bare">https://tools.ietf.org/rfc/rfc3986.txt</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
 2.0-RC1<br>
Last updated 2020-02-10 13:45:19 UTC
</div>
</div>
</body>
</html>